<!DOCTYPE html>
<html lang="en-US">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="ttw" content="cfanq3r">


<title>A critical review of ECMAScript 6 quasi-literals - Human Who Codes</title>
<meta name="twitter:site" content="@humanwhocodes">
<meta name="twitter:creator" content="@slicknet">
<meta name="twitter:url" content="https://humanwhocodes.com/blog/2012/08/01/a-critical-review-of-ecmascript-6-quasi-literals/" />
<meta name="twitter:image" content="https://humanwhocodes.com/images/favicon.png" />
<meta name="twitter:image:alt" content="Human Who Codes" />
<meta name="twitter:title" content="A critical review of ECMAScript 6 quasi-literals">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">

<meta name="og:image" content="https://humanwhocodes.com/images/favicon.png" />
<meta name="og:url" content="https://humanwhocodes.com/blog/2012/08/01/a-critical-review-of-ecmascript-6-quasi-literals/" />
<meta name="og:title" content="A critical review of ECMAScript 6 quasi-literals">
<meta name="og:description" content="">
<meta name="og:type" content="article">



<link rel="stylesheet" href="../../../../../styles/index.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Human Who Codes - Blog" href="https://humanwhocodes.com/feeds/blog.xml">
<link rel="alternate" type="application/json" title="Human Who Codes - Blog" href="https://humanwhocodes.com/feeds/blog.json">
<link rel="alternate" type="application/rss+xml" title="Human Who Codes - Snippets" href="https://humanwhocodes.com/feeds/snippets.xml">
<link rel="alternate" type="application/json" title="Human Who Codes - Snippets" href="https://humanwhocodes.com/feeds/snippets.json">
<link rel="alternate" type="application/rss+xml" title="Human Who Codes - Everything" href="https://humanwhocodes.com/feeds/all.xml">
<link rel="alternate" type="application/json" title="Human Who Codes - Everything" href="https://humanwhocodes.com/feeds/all.json">
<link rel="icon" type="image/png" href="https://humanwhocodes.com/images/favicon.png">


<link rel="canonical" href="index.html">



<meta name="description" content="Quasi-literals (update: now formally called “template strings”) are a proposed addition to ECMAScript 6 designed to solve a whole host of problems. The proposal seeks to add new syntax that would allow the...">
<meta name="keywords" content="ECMAScript 6,JavaScript,Quasis,Nicholas,Zakas,NCZOnline">

<script src="../../../../../scripts/emailform.js" async></script>
</head>
<body itemscope itemtype="http://schema.org/WebPage">
    <header class="highlight-background">
        <nav role="navigation" class="page-width center center-text gutters collapsible-corners">
            <h1 class="no-margin"><a href="https://humanwhocodes.com/"><img src="../../../../../images/logo-full-web.svg" alt="Human Who Codes" height="50"></a></h1>
            <ul class="inline-list inline-spaced-list center-text-on-small-screens overflow-x-scroll bigger-font all-caps bold">
                <li class="hide-offscreen"><a href="index.html#content">Skip to content</a></li>
                <li><a href="https://humanwhocodes.com/books/" class="dark-text no-underline">Books</a></li>
                <li><a href="https://humanwhocodes.com/reading/" class="dark-text no-underline">Reading</a></li>
                <!-- <li><a href="/speaking/" class="dark-text no-underline">Speaking</a></li> -->
                <li><a href="https://humanwhocodes.com/donate/" class="dark-text no-underline">Donate</a></li>
                <li><a href="https://humanwhocodes.com/contact/" class="dark-text no-underline">Contact</a></li>
            </ul>
        </nav>
    </header>
    <hr>
    <div class="content-background">
        <div id="page-grid" class="page-width page-grid center">
            <main id="content" role="main" class="content-width gutters">

<article itemtype="http://schema.org/Article">
    <header>
        <h1 itemprop="headline" class="no-margin gutter-bottom headline-text">A critical review of ECMAScript 6 quasi-literals</h1>
        
        <div class="post-meta gutter-top smaller-font dark-dotted-border-top dark-dotted-border-bottom">
            <p class="no-margin byline">Posted at <time datetime="2012-08-01T00:00:00+00:00" itemprop="datePublished">August 1, 2012</time> by <span itemprop="author" itemtype="http://schema.org/Person">Nicholas
                    C. Zakas</span></p>
            <p class="no-margin-top tags">Tags:
                
                <a href="https://humanwhocodes.com/blog/tag/ecmascript-6" rel="tag">ECMAScript 6</a>,
                
                <a href="https://humanwhocodes.com/blog/tag/javascript" rel="tag">JavaScript</a>,
                
                <a href="https://humanwhocodes.com/blog/tag/quasis" rel="tag">Quasis</a>
                
            </p>
        </div>
    </header>
    <section id="post-body" class="content-font">
        
<p>Quasi-literals (update: now formally called “template strings”) are a proposed addition to ECMAScript 6 designed to solve a whole host of problems. The proposal seeks to add new syntax that would allow the creation of domain-specific languages (DSLs)<sup><a href="http://en.wikipedia.org/wiki/Domain-specific_language">1</a></sup> for working with content in a way that is safer than the solutions we have today. The description on the <cite>template string-literal strawman page</cite><sup><a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis">2</a></sup> is as follows:</p>

<blockquote>
  <p>This scheme extends EcmaScript syntax with syntactic sugar to allow libraries to provide DSLs that easily produce, query, and manipulate content from other languages that are immune or resistant to injection attacks such as XSS, SQL Injection, etc.</p>
</blockquote>

<p>In reality, though, template strings are ECMAScript’s answer to several ongoing problems. As best I can figure, these are the immediate problems template strings attempt to address:</p>

<ol>
  <li><strong>Multiline strings</strong> – JavaScript has never had a formal concept of multiline strings.</li>
  <li><strong>Basic string formatting</strong> – The ability to substitute parts of the string for values contained in variables.</li>
  <li><strong>HTML escaping</strong> – The ability to transform a string such that it is safe to insert into HTML.</li>
  <li><strong>Localization of strings</strong> – The ability to easily swap out string from one language into a string from another language.</li>
</ol>

<p>I’ve been looking at template strings to figure out if they actually solve these problems sufficiently or not. My initial reaction is that template strings solve some of these problems in certain situations but aren’t useful enough to be the sole mechanism of addressing these problems. I decided to take some time and explore template strings to figure out if my reaction was valid or not.</p>

<h2 id="the-basics">The basics</h2>

<p>Before digging into the use cases, it’s important to understand how template strings work. The basic format for template strings is as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`literal${substitution}literal`
</code></pre></div></div>

<p>This is the simplest form of template string that simply does substitutions. The entire template string is enclosed in backticks. In between those backticks can be any number of characters including white space. The dollar sign (<code class="highlighter-rouge">$</code>) indicates an expression that should be substituted. In this example, the template string would replace <code class="highlighter-rouge">${substitution}</code> With the value of the JavaScript variable called <code class="highlighter-rouge">substitution</code> That is available in the same scope in which the template string is defined. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var name = "Nicholas",
    msg = `Hello, ${name}!`;
    
console.log(msg);    // "Hello, Nicholas!"
</code></pre></div></div>

<p>In this code, the template string has a single identifier to substitute. The sequence <code class="highlighter-rouge">${name}</code> is replaced by the value of the variable <code class="highlighter-rouge">name</code>. You can substitute more complex expressions, such as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var total = 30,
    msg = `The total is ${total} (${total*1.05} with tax)`;
    
console.log(msg);       // "The total is 30 (31.5 with tax)"
</code></pre></div></div>

<p>This example uses a more complex expression substitution to calculate the price with tax. You can place any expression that returns a value inside the braces of a template string to have that value inserted into the final string.</p>

<p>The more advanced format of a template string is as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tag`literal${substitution}literal`
</code></pre></div></div>

<p>This form includes a tag, which is basically just a function that alters the output of the template string. The template string proposal includes a proposal for several built-in tags to handle common cases (those will be discussed later) but it’s also possible to define your own.</p>

<p>A tag is simply a function that is called with the processed template string data. The function receives data about the template string as individual pieces that the tag must then combined to create the finished value. The first argument the function receives is an array containing the literal strings as they are interpreted by JavaScript. These arrays are organized such that a substitution should be made between items, so there needs to be a substitution made between the first and the second item, the second and the third item, and so on. This array also has a special property called <code class="highlighter-rouge">raw</code>, which is an array containing the literal strings as they appear in the code (so you can tell what was written in the code). Each subsequent argument to the tag after the first is the value of a substitution expression in the template string. For example, this is what would be passed to a tag for the last example:</p>

<ul>
  <li>Argument 1 = <code class="highlighter-rouge">[ "The total is ", " (", " with tax)" ]</code>
    <ul>
      <li><code class="highlighter-rouge">.raw = [ "The total is ", " (", " with tax)" ]</code></li>
    </ul>
  </li>
  <li>Argument 2 = <code class="highlighter-rouge">30</code></li>
  <li>Argument 3 = <code class="highlighter-rouge">31.5</code></li>
</ul>

<p>Note that the substitution expressions are automatically evaluated, so you just receive the final values. That means the tag is free to manipulate the final value in any way that is appropriate. For example, I can create a tag that behaves the same as the defaults (when no tag specified) like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function passthru(literals) {
    var result = "",
        i = 0;
        
    while (i &lt; literals.length) {
        result += literals[i++];
        if (i &lt; arguments.length) {
            result += arguments[i];
        }
    }
    
    return result;

}&lt;/code&gt;
</code></pre></div></div>

<p>And then you can use it like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var total = 30,
    msg = passthru`The total is ${total} (${total*1.05} with tax)`;
    
console.log(msg);       // "The total is 30 (31.5 with tax)"
</code></pre></div></div>

<p>In all of these examples, there has been no difference between <code class="highlighter-rouge">raw</code> and <code class="highlighter-rouge">cooked</code> Because there were no special characters within the template string. Consider template string like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tag`First line\nSecond line`
</code></pre></div></div>

<p>In this case, the tag would receive:</p>

<ul>
  <li>Argument 1 = <code class="highlighter-rouge">cooked = [ "First line\nSecond line" ]</code>
    <ul>
      <li><code class="highlighter-rouge">.raw = [ "First line\\nSecond line" ]</code></li>
    </ul>
  </li>
</ul>

<p>Note that the first item in <code class="highlighter-rouge">raw</code> is an escaped version of the string, effectively the same thing that was written in code. May not always need that information, but it’s around just in case.</p>

<h2 id="multiline-strings">Multiline strings</h2>

<p>The first problem that template string literals were meant to address his multiline strings. As I’ve mentioned in previous posts, this isn’t a big problem for me, but I know that there are a fair number of people who would like this capability. There has been an unofficial way of doing multiline string literals and JavaScript for years using a backslash followed by a newline, such as this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var text = "First line\n\
Second line";
</code></pre></div></div>

<p>This has widely been acknowledged as a mistake and something that is considered a bad practice, although it was blessed as part of ECMAScript 5. Many resort to using arrays in order not to use the unofficial technique:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var text = [ 
    "First line", 
    "Second line"].join("\n");
</code></pre></div></div>

<p>However, this is pretty cumbersome if you’re writing a lot of text. It would definitely be easier to have a way to include<br />
this directly within the literal. Other languages have had this feature for years.</p>

<p>There are of course heredocs<sup><a href="http://en.wikipedia.org/wiki/Here_document">3</a></sup>, such as what is supported in PHP:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$text = &lt;&lt;&lt;EOF
First line
Second line
EOF;
</code></pre></div></div>

<p>And Python has its triple quoted strings:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>text = """First line
Second line"""
</code></pre></div></div>

<p>In comparison, template string-literals look cleaner because they use fewer characters:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var text = `First line
Second line`;
</code></pre></div></div>

<p>So it’s pretty easy to see that template strings solve the problem of multiline strings in JavaScript pretty well. This is undoubtedly a case where new syntax is needed, because both the double quote and single quote are already spoken for (and pretty much are exactly the same).</p>

<h2 id="basic-string-formatting">Basic string formatting</h2>

<p>The problem the basic string formatting hasn’t been solved in JavaScript yet. When I say basic string formatting, I’m talking about simple substitutions within text. Think of <code class="highlighter-rouge">sprintf</code> in C or <code class="highlighter-rouge">String.format()</code> in C# or Java. This comment isn’t particularly for and JavaScript, finding life in a few corners of development.</p>

<p>First, the <code class="highlighter-rouge">console.log()</code> method (and its related methods) support basic string formatting in Internet Explorer 8+, Firefox, Safari, and Chrome (Opera doesn’t support string formatting on the console). On the server, Node.js also supports string formatting for its <code class="highlighter-rouge">console.log()</code><sup><a href="http://docs.jit.su/articles/getting-started/the-console-module">4</a></sup>. You can include <code class="highlighter-rouge">%s</code> to substitute a string, <code class="highlighter-rouge">%d</code> or <code class="highlighter-rouge">%i</code> to substitute an integer, or <code class="highlighter-rouge">%f</code> for floating-point vlaues (Node.js also allows <code class="highlighter-rouge">%j</code> for including JSON, Firefox and Chrome allow <code class="highlighter-rouge">%o</code> for outputting an object<sup><a href="https://developer.mozilla.org/en/DOM/console#Outputting_text_to_the_console">5</a></sup>). For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.log("Hello %s", "world");  // "Hello world"
console.log("The count is %d", 5);    // "The count is 5"
</code></pre></div></div>

<p>Various JavaScript libraries have also implemented similar string formatting functions. YUI has the <code class="highlighter-rouge">substitute()</code><sup><a href="http://yuilibrary.com/yui/docs/api/classes/YUI~substitute.html#method_substitute">6</a></sup> method, which uses named values for string replacements:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>YUI().use("substitute", function(Y) {

    var msg = Y.substitute("Hello, {place}", { place: "world" });
    console.log(msg);   // "Hello, world"

});
</code></pre></div></div>

<p>Dojo has a similar mechanism via <code class="highlighter-rouge">dojo.string.substitute()</code><sup><a href="http://livedocs.dojotoolkit.org/dojo/string#substitute">7</a></sup>, though it can also deal with positional substitutions by passing an array:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var msg = dojo.string.substitue("Hello, ${place}", { place: "world" });
console.log(msg);   // "Hello, world"

msg = dojo.string.substitue("Hello, ${0}", [ "world" ]);
console.log(msg);   // "Hello, world"
</code></pre></div></div>

<p>It’s clear that basic string formatting is already alive and well in JavaScript and chances are that many developers have used it at some point in time. Keep in mind, simple string formatting isn’t concerned with escaping of values because it is doing simple string manipulation (HTML escaping is discussed later).</p>

<p>In comparison to the already available string formatting methods, template strings visually appear to be very much the same. Here’s how the previous examples would be written using a template string:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var place = "world",
    msg = `Hello, ${place}`;
    
console.log(msg);   // "Hello, world"
</code></pre></div></div>

<p>Syntactically, one could argue that template strings are easier to read because the variable is placed directly into the literal so you can guess the result more easily. So if you’re going to be converting code using older string formatting methods into template strings, it’s a pretty easy conversion if you are using string literals directly in your JavaScript.</p>

<p>The downside of template strings is the same downside experienced using heredocs: the literal must be defined in a scope that has access to the substitution variables. There are couple of problems with this. First, if a substitution variable isn’t defined in the scope in which a template string is defined, it will throw an error. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var msg = `Hello, ${place}`;    // throws error
</code></pre></div></div>

<p>Because <code class="highlighter-rouge">place</code> isn’t defined in this example, the template string actually throws an error because it’s trying to evaluate the variable that doesn’t exist. That behavior is also cause of the second major problem with template strings: you cannot externalize strings.</p>

<p>When using simple string formatting, as with <code class="highlighter-rouge">console.log()</code>, YUI, or Dojo, you have the ability to keep your strings external from the JavaScript code that uses it. This has the advantage of making string changes easier (because they aren’t buried inside of JavaScript code) and allowing the same strings to be used in multiple places. For example, you can define your strings in one place such as this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var messages = {
    welcome: "Hello, {name}"
};
</code></pre></div></div>

<p>And use them somewhere else like this:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var msg = Y.substitute(messages.welcome, { name: "Nicholas" });
</code></pre></div></div>

<p>With template strings, you are limited to using substitution only when the literal is embedded directly in your JavaScript along with variables representing the data to substitute. In effect, format strings have late binding to data values and template strings have early binding to data values. That early binding severely limits the cases where template strings can be used for the purpose of simple substitutions.</p>

<p>So while template strings solve the problem of simple string formatting when you want to embed literals in your JavaScript code, they do not solve the problem when you want to externalize strings. For this reason, I believe that even with the addition of template strings, some basic string formatting capabilities need to be added to ECMAScript.</p>

<h2 id="localization-of-strings">Localization of strings</h2>

<p>Closely related to simple string formatting is localization of strings. Localization is a complex problem encompassing all aspects of a web application, but localization of strings is what template strings are supposed to help with. The basic idea is that you should be able to define a string with placeholders in one language and be able to easily translate the strings into another language that makes use of the same substitutions.</p>

<p>The way this works in most systems today is that strings are externalized into a separate file or data structure. Both YUI<sup><a href="http://dojotoolkit.org/reference-guide/1.7/quickstart/internationalization/resource-bundling.html">9</a></sup> and Dojo<sup><a href="http://en.wikipedia.org/wiki/Uncontrolled_format_string">10</a></sup> support externalized resource bundles for internationalization. Fundamentally, these work the same way as simple string formatting does, where each of the strings is a separate property in an object that can be used in any number of places. The strings can also contain placeholders for substitutions by the library’s method for doing so. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// YUI
var messages = Y.Intl.get("messages");
console.log(messages.welcome, { name: "Nicholas" });
</code></pre></div></div>

<p>Since the placeholder in the string never changes regardless of language, the JavaScript code is kept pretty clean and doesn’t need to take into account things like different order of words and substitutions in different languages.</p>

<p>The approach that template strings seemed to be recommending is more one of a tool-based process. The strawman proposal talks about a special <code class="highlighter-rouge">msg</code> tag that is capable of working with localized strings. The purpose of <code class="highlighter-rouge">msg</code> is only to make sure that the substitutions themselves are being formatted correctly for the current locale (which is up to the developer to define). Other than that, it appears to only do basic string substitution. The intent seems to be to allow static analysis of the JavaScript file such that a new JavaScript file can be produced that correctly replaces the contents of the template string with text that is appropriate for the locale. The first example given is of translating English into French assuming that you already have the translation data somewhere:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Before
alert(msg`Hello, ${world}!`);
 
// After
alert(msg`Bonjour ${world}!`);
</code></pre></div></div>

<p>The intent is that the first line is translated to the second line by some as-yet-to-be-defined tool. For those who don’t want to use this tool, the proposal suggests including the message bundle in line such that the <code class="highlighter-rouge">msg</code> tag looks up its data in that bundle in order to do the appropriate replacement. Here is that example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Before
alert(msg`Hello, ${world}!`);
 
// After
var messageBundle_fr = {  // Maps message text and disambiguation meta-data to replacement.
  'Hello, {0}!': 'Bonjour {0}!'
};
 
alert(msg`Hello, ${world}!`);
</code></pre></div></div>

<p>The intent is that the first line is translated into the several lines after it before going to production. You’ll note that in order to make this work, the message bundle is using format strings. The <code class="highlighter-rouge">msg</code> tag is then written as:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function msg(parts) {
  var key = ...;  // 'Hello, {0}!' given ['Hello, ', world, '!']
 
  var translation = myMessageBundle[key];
 
  return (translation || key).replace(/\{(\d+)\}/g, function (_, index) {
      // not shown: proper formatting of substitutions
      return parts[(index &lt; &lt; 1) | 1];
    });
}&lt;/code&gt;
</code></pre></div></div>

<p>So it seems that in an effort to avoid format strings, template strings are only made to work for localization purposes by implementing its own simple string formatting.</p>

<p>For this problem, it seems like I’m actually comparing apples to oranges. The way that YUI and Dojo deal with localized strings and resource bundles is very much catered towards developers. The template string approach is very much catered towards tools and is therefore not very useful for people who don’t want to go through the hassle of integrating an additional tool into their build system. I’m not convinced that the localization scheme in the proposal represents a big advantage over what developers have already been doing.</p>

<h2 id="html-escaping">HTML escaping</h2>

<p>This is perhaps the biggest problem that template strings are meant to address. Whenever I talk to people on TC-39 about template strings, the conversation always seems to come back to secure escaping for insertion into HTML. The proposal itself starts out by talking about cross-site scripting attacks and how template strings help to mitigate them. Without a doubt, proper HTML escaping is important for any web application, both on the client and on the server. Fortunately, we have seen some more logical typesetting languages pop up, such as Mustache, which automatically escape output by default.</p>

<p>When talking about HTML escaping, it’s important to understand that there are two distinct classes of data. The first class of data is controlled. Controlled data is data that is generated by the server without any user interaction. That is to say the data was programmed in by developer and was not entered by user. The other class of data is uncontrolled, which is the very thing that template strings were intended to deal with. Uncontrolled data is data that comes from the user and you can therefore make no assumptions about its content. One of the big arguments against format strings is the threat of uncontrolled format strings<sup><a href="http://wiki.ecmascript.org/doku.php?id=strawman:string_format">11</a></sup> and the damage they can cause. This happens when uncontrolled data is passed into a format string and isn’t properly escaped along the way. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// YUI
var html = Y.substitute("&gt;p&lt;Welcome, {name}&gt;/p&lt;", { name: username });
</code></pre></div></div>

<p>In this code, the HTML generated could potentially have a security issue if <code class="highlighter-rouge">username</code> hasn’t been sanitized prior to this point. It’s possible that <code class="highlighter-rouge">username</code> could contain HTML code, most notably JavaScript, that could compromise the page into which the string was inserted. This may not be as big of an issue on the browser, where script tags are innocuous when inserted via <code class="highlighter-rouge">innerHTML</code>, but on the server this is certainly a major issue. YUI has <code class="highlighter-rouge">Y.Escape.html()</code> to escape HTML that could be used to help:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// YUI
YUI().use("substitute", "escape", function(Y) {
    var escapedUsername = Y.Escape.html(username),
        html = Y.substitute("&gt;p&lt;Welcome, {name}&gt;/p&lt;", { name: escapedUsername });
});
</code></pre></div></div>

<p>After HTML escaping, the username is a bit more sanitized before being inserted into the string. That provides you with a basic level of protection against uncontrolled data. The problems can get a little more complicated than that, especially when you’re dealing with values that are being inserted into HTML attributes, but essentially escaping HTML before inserting into an HTML string is the minimum you should do to sanitize data.</p>

<p>Template strings aim to solve the problem of of HTML escaping plus a couple of other problems. The proposal talks about a tag called <code class="highlighter-rouge">safehtml</code>, which would not only perform HTML escaping, but would also look for other attack patterns and replace them with innocuous values. The example from the proposal is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url = "http://example.com/";
message = query = "Hello &amp; Goodbye";
color = "red";
safehtml`&lt;a href="${url}?q=${query}" onclick=alert(${message}) style="color: ${color}"&gt;${message}&lt;/a&gt;`
</code></pre></div></div>

<p>In this instance, there are a couple potential security issues in the HTML literal. The URL itself could end up being a JavaScript URL that does something bad, the query string could also end up being something bad, and the CSS value could end up being a CSS expression in older versions of Internet Explorer. For instance:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>url = "javascript:alert(1337)";
color = "expression(alert(1337))";
</code></pre></div></div>

<p>Inserting these values into a string using simple HTML escaping, as in the previous example, would not prevent the resulting HTML from containing dangerous code. An HTML-escaped JavaScript URL still executes JavaScript. The intent of <code class="highlighter-rouge">safehtml</code> is to not only deal with HTML escaping but also to deal with these attack scenarios, where a value is dangerous regardless of it being escaped or not.</p>

<p>The template string proposal claims that in a case such as with JavaScript URLs, the values will be replaced with something completely innocuous and therefore prevent any harm. What it doesn’t cover is how the tag will know whether a “dangerous” value is actually controlled data and intentionally being inserted versus uncontrolled data that should always be changed. My hunch from reading the proposal is that it always assumes dangerous values to be dangerous and it’s up to the developer to jump through hoops to include some code that might appear dangerous to the tag. That’s not necessarily a bad thing.</p>

<p>So do template strings solve the HTML escaping problem? As with simple string formatting, the answer is yes, but only if you are embedding your HTML right into JavaScript where the substitution variables exist. Embedding HTML directly into JavaScript is something that I warned people not to do because it becomes hard to maintain. With templating solutions such as Mustache, the templates are often read in at runtime from someplace or else precompiled into functions that are executed directly. It seems that the intended audience for the <code class="highlighter-rouge">safehtml</code> tag might actually be the template libraries. I could definitely see this being useful when templates are compiled. Instead of compiling into complicated functions, the templates could be compiled into template strings using the <code class="highlighter-rouge">safehtml</code> tag. That would eliminate some of the complexity of template languages, though I’m sure not all.</p>

<p>Short of using a tool to generate template strings from strings or templates, I’m having a hard time believing that developers would go through the hassle of using them when creating a simple HTML escape function is so easy. Here’s the one that I tend to use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function escapeHTML(text) {
    return text.replace(/[&lt;&gt;"&amp;]/g, function(c) {
        switch (c) {
            case "&lt; ":  return "&amp;lt;";
            case "&gt;":   return "&amp;gt;";
            case "\"":  return "&amp;quot;";
            case "&amp;#038;":   return "&amp;amp;";
        }
    });
}
</code></pre></div></div>

<p>I recognize that doing basic HTML escaping isn’t enough to completely secure an HTML string against all threats. However, if the template string-based HTML handling must be done directly within JavaScript code, and I think many developers will still end up using basic HTML escaping instead. Libraries are already providing this functionality to developers, it would be great if we could just have a standard version that everyone can rely on so we can stop shipping the same thing with every library. As with the <code class="highlighter-rouge">msg</code> tag, which needs simple string formatting to work correctly, I could also see <code class="highlighter-rouge">safehtml</code> needing basic HTML escaping in order to work correctly. They seem to go hand in hand.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Template strings definitely address all four of the problems I outlined at the beginning of this post. They are most successful in addressing the need to have multiline string literals in JavaScript. The solution is arguably the most elegant one available and does the job well.</p>

<p>When it comes to simple string formatting, template strings solve the problem in the same way that heredocs solve the problem. It’s great if you are going to be embedding your strings directly into the code near where the substitution variables exist. If you need to externalize your strings, then template strings aren’t solving the problem for you. Given that many developers externalize strings into resource bundles that are included with their applications, I’m pessimistic about the potential for template strings to solve the string formatting needs of many developers. I believe that a format string-based solution, such as the one that was Crockford proposed<sup>[12]</sup>, still needs to be part of ECMAScript for it to be complete and for this problem to be completely solved.</p>

<p>I’m not at all convinced that template strings solve a localization use case. It seems like this use case was shoehorned in and that current solutions require a lot less work implement. Of course, the part that I found most interesting about the template strings solution for localization is that it made use of format strings. To me, that’s a telling sign that simple string formatting is definitely needed in ECMAScript. Template strings seem like the most heavy-handed solution to the localization problem, even with the as-yet-to-be-created tools that the proposal talks about.</p>

<p>Template strings definitely solve the HTML escaping problem, but once again, only in the same way that simple string formatting is solved. With the requirement of embedding your HTML inside of the JavaScript and having all variables present within that scope, the <code class="highlighter-rouge">safehtml</code> tag seems to only be useful from the perspective of templating tools. It doesn’t seem like something that developers will use by hand since many are using externalized templates. If templating libraries that precompiled templates are the target audience for this feature then it has a shot at being successful. I don’t think, however, that it serves the needs of other developers. I still believe that HTML escaping, as error-prone as it might be, is something that needs to be available as a low-level method in ECMAScript.</p>

<p>Note: I know there are a large number of people who believe HTML escaping shouldn’t necessarily be part of ECMAScript. Some say it should be a browser API, part of the DOM, or something else. I disagree with that sentiment because JavaScript is used quite frequently, on both the client and server, to manipulate HTML. As such, I believe that it’s important for ECMAScript to support HTML escaping along with URL escaping (which it has supported for a very long time).</p>

<p>Overall, template strings are an interesting concept that I think have potential. Right off the bat, they solve the problem of having multiline strings and heredocs-like functionality in JavaScript. They also appear to be an interesting solution as a generation target for tools. I don’t think that they are a suitable replacement for simple string formatting or low-level HTML escaping for JavaScript developers, both of which could be useful within tags. I’m not calling for template strings to be ripped out of ECMAScript, but I do think that it doesn’t solve enough of the problems for JavaScript developers that it should preclude other additions for string formatting and escaping.</p>

<p><strong>Update (01-August-2012)</strong> – Updated article to mention that braces are always required in template strings. Also, addressed some of the feedback from Allen’s comment by changing “quasi-literals” to “template strings” and “quasi handlers” to “tags”. Updated description of slash-trailed multiline strings.</p>

<p><strong>Update (02-August-2012)</strong> – Fixed YUI method name based on Ryan’s comment. Fixed <code class="highlighter-rouge">escapeHTML()</code> function encoding issue per Jakub’s comment.</p>

<h2 id="references">References</h2>

<ol>
  <li><a href="http://en.wikipedia.org/wiki/Domain-specific_language">Domain-specific language</a> (Wikipedia)</li>
  <li><a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis">ECMAScript quasi-literals</a> (ECMAScript Wiki)</li>
  <li><a href="http://en.wikipedia.org/wiki/Here_document">Here-Documents</a> (Wikipedia)</li>
  <li><a href="http://docs.jit.su/articles/getting-started/the-console-module">The built-in console module</a> by Charlie McConnell (Nodejitsu)</li>
  <li><a href="https://developer.mozilla.org/en/DOM/console#Outputting_text_to_the_console">Outputting text to the console</a> (Mozilla Developer Network)</li>
  <li><a href="http://yuilibrary.com/yui/docs/api/classes/YUI~substitute.html#method_substitute">YUI substitute method</a> (YUILibrary)</li>
  <li><a href="http://livedocs.dojotoolkit.org/dojo/string#substitute">dojo.string.substitute()</a> (Dojo Toolkit)</li>
  <li><a href="http://yuilibrary.com/yui/docs/intl/">YUI Internationalization</a> (YUILibrary)</li>
  <li><a href="http://dojotoolkit.org/reference-guide/1.7/quickstart/internationalization/resource-bundling.html">Translatable Resource Bundles</a> by Adam Peller</li>
  <li><a href="http://en.wikipedia.org/wiki/Uncontrolled_format_string">Uncontrolled format string</a> (Wikipedia)</li>
  <li><a href="http://wiki.ecmascript.org/doku.php?id=strawman:string_format">String.prototype.format</a> by Douglas Crockford (ECMAScript Wiki)</li>
</ol>


<!--
<div class="center-text">


</div>-->
    </section>
    <footer>
        <div class="gutters round-borders cta-background margin-bottom">
            <h3 class="no-margin-top">Was this helpful?</h3>
            <p>If you found this post helpful, please consider donating to support my work.</p>
            <ul class="inline-list grid-columns">
                <li class="center-text"><a href="https://github.com/users/nzakas/sponsorship" class="link-btn cta-btn">Donate with GitHub</a></li>
                <li class="center-text"><a href="https://www.paypal.com/donate/?token=QV5gLG9Q5szfku7XrfOVQLxk25R5wYQgS5Li_q0si6WRF_XYkhpV6DM0pTIkyQtXDW00tW&country.x=US&locale.x=US" class="link-btn cta-btn">Donate with PayPal</a></li>
            </ul>
        </div>
    </footer>
<!--
    <footer class="media-box gutters round-borders cta-background margin-bottom">
        <div class="media-box-media">
            <a href="/donate" class="link-btn cta-btn">Donate</a>
        </div>
        <div>
            <p class="no-margin"><b>Was this helpful?</b> If you found this post helpful, I would very much appreciate your support. Donations of any amount gratefully accepted.</p>
        </div>
    </footer>
-->
</article>

<div class="grid-columns">
    <div class="gutters round-borders content-item-border highlight-background">
        
        <h2 class="no-margin-top">Popular Posts</h2>
<ul class="block-list">

<li><a href="../../../06/12/the-care-and-feeding-of-software-engineers-or-why-engineers-are-grumpy/index.html">The care and feeding of software engineers (or why engineers are grumpy)</a></li>

<li><a href="../../../../2018/10/my-somewhat-complete-salary-history-software-engineer/index.html">My (somewhat) complete salary history as a software engineer</a></li>

<li><a href="../../../../2015/09/my-favorite-interview-question/index.html">My favorite interview question</a></li>

<li><a href="../../../../2009/07/28/the-best-way-to-load-external-javascript/index.html">The best way to load external JavaScript</a></li>

<li><a href="../../../../2009/05/05/http-cookies-explained/index.html">HTTP cookies explained</a></li>

</ul>

    </div>
    <div class="gutters round-borders content-item-border highlight-background">
        <h2 class="no-margin-top">Join the Mailing List</h2>
        <p>Never miss an update by joining 3,000 other mailing list members.</p>
        <form method="post" name="sideemailform" action="https://mailinglist.humanwhocodes.com/api/subscribe">
            <div id="mc_embed_signup_scroll">
                <div style="margin-bottom: 0.5em">
                    <label>First name:
                        <input type="text" value="" style="width:100%" name="firstName">
                    </label>
                </div>
                <div style="margin-bottom: 0.5em">
                    <label>Last name:
                        <input type="text" value="" style="width:100%" name="lastName">
                    </label>
                </div>
                <div>
                    <label>Email address:
                        <input type="email" value="" style="width:100%" name="email" required>
                    </label>
                </div>
                <input type="hidden" name="formId" value="1408574">
                <div class="center-text gutters">
                    <input type="submit" value="Subscribe">
                </div>
            </div>
        </form>
    </div>
</div>



<div id="disqus_thread" class="hide-on-mobile"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'nczonline',
        disqus_url = 'http://humanwhocodes.com/blog/2012/08/01/a-critical-review-of-ecmascript-6-quasi-literals/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


        </main>

        <div id="sidebar" class="sidebar-width sidebar-background gutters hide-on-small-screens">
            <h1 class="hide-offscreen">Additional Information</h1>
            <script async type="text/javascript" src="https://cdn.carbonads.com/carbon.js?serve=CKYIEK3Y&amp;placement=humanwhocodescom" id="_carbonads_js"></script>
        
            
            
            <h2 class="smaller-font">Top Sponsors</h2>
            <ul class="inline-list inline-image-list">
                
                <li><a href="https://github.com/scoutapm-sponsorships"><img src="https://avatars.githubusercontent.com/u/71095532?u=9f5a794ddc3b67ba057ee65e7ce166ad205a76c2&v=4" alt="Scout APM Sponsorships" width="90" style="padding: 5px; border-radius: 50%"></a></li>
                
            </ul>
            

            <h2 class="smaller-font">My Books</h2>
            <ul class="inline-list inline-image-list">
                
                
                <li><a href="https://geni.us/hwc-es6-book"><img src="../../../../../images/books/understandinges6ns.png" alt="Understanding ECMAScript 6" width="100"></a></li>
                
                <li><a href="https://geni.us/hwc-oopjs-book"><img src="../../../../../images/books/oopinjsns.png" alt="The Principles of Object-Oriented JavaScript" width="100"></a></li>
                
                <li><a href="https://geni.us/hwc-mjs-book"><img src="../../../../../images/books/maintainablejs.png" alt="Maintainable JavaScript" width="100"></a></li>
                
                <li><a href="https://amzn.to/2JBDt96"><img src="../../../../../images/books/pro_js_3e.png" alt="Professional JavaScript for Web Developers, 3rd Edition" width="100"></a></li>
                
            </ul>
            <h2 class="smaller-font">Recent Snippets</h2>
            <ul class="">
                
                
                <li><a href="https://humanwhocodes.com/snippets/2021/03/create-user-linux-ssh-key/">Creating a new user with an SSH key on Linux</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2021/02/how-to-setup-deploy-web-application-dokku/">How to setup and deploy a web application on Dokku</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2021/02/how-to-regain-jenkins-web-access-after-lockout/">How to regain Jenkins web access after being locked out</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2020/10/create-typescript-declarations-from-javascript-jsdoc/">Create TypeScript declarations from JavaScript and JSDoc</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2020/10/read-environment-variables-deno/">How to read environment variables in Deno using JavaScript</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2020/08/validate-github-webhook-signature-nodejs/">How to validate the signature of a GitHub webhook using Node.js</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2020/07/eleventy-heading-ids/">How to generate ID attributes in headings using Eleventy</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2020/02/optionally-await-function-result/">How to optionally await a JavaScript function call</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2019/05/jest-globals-intellisense-visual-studio-code/">Setting up Visual Studio Code intellisense for Jest globals</a></li>
                
                <li><a href="https://humanwhocodes.com/snippets/2019/05/nodejs-read-stream-promise/">Reading streams with promises in Node.js</a></li>
                
            </ul>
            <h2 class="smaller-font">Archives</h2>
            <ul>


                <li><a href='https://humanwhocodes.com/blog/2021/'>2021</a></li>

                <li><a href='https://humanwhocodes.com/blog/2020/'>2020</a></li>

                <li><a href='https://humanwhocodes.com/blog/2019/'>2019</a></li>

                <li><a href='https://humanwhocodes.com/blog/2018/'>2018</a></li>


                <li><a href='https://humanwhocodes.com/blog/2016/'>2016</a></li>

                <li><a href='https://humanwhocodes.com/blog/2015/'>2015</a></li>

                <li><a href='https://humanwhocodes.com/blog/2014/'>2014</a></li>

                <li><a href='https://humanwhocodes.com/blog/2013/'>2013</a></li>

                <li><a href='https://humanwhocodes.com/blog/2012/'>2012</a></li>

                <li><a href='https://humanwhocodes.com/blog/2011/'>2011</a></li>

                <li><a href='https://humanwhocodes.com/blog/2010/'>2010</a></li>

                <li><a href='https://humanwhocodes.com/blog/2009/'>2009</a></li>

                <li><a href='https://humanwhocodes.com/blog/2008/'>2008</a></li>

                <li><a href='https://humanwhocodes.com/blog/2007/'>2007</a></li>

                <li><a href='https://humanwhocodes.com/blog/2006/'>2006</a></li>

                <li><a href='https://humanwhocodes.com/blog/2005/'>2005</a></li>

                <li><a href='https://humanwhocodes.com/blog/2004/'>2004</a></li>

            </ul>

        </div> <!-- sidebar -->
    </div> <!-- page-grid -->
</div> <!-- content-background -->
<hr>
<footer class="inverted-colors">
    <div class="page-width center">
        <div class="page-grid orange-border-bottom">
            <div class="margin-top content-width gutters">
                <div class="collapsible-media-box">
                    <div class="media-box-media center-text">
                        <img src="../../../../../images/me/me-150x150.jpg" alt="Photo of Nicholas C. Zakas" width="150" class="circle-image">
                    </div>
                    <div>
                        <h2 class="no-margin-top center-text-on-mobile">About the Human</h2>
                        <p>Hi, I'm Nicholas C. Zakas, an independent software developer living in Mountain View, California. 
                            I've been a software architect at companies like Yahoo and Box, as well as an author and speaker. 
                            I created the <a href="https://eslint.org">ESLint</a> open source project and wrote several 
                            <a href="https://humanwhocodes.com/books">books</a>. At the moment, I'm <a href="../../../../2014/04/02/i-have-lyme-disease/index.html">recovering from Lyme disease</a> 
                            and haven't been able to leave my home much in the past five years. (<a href="https://medium.com/lyme-disease-warrior/progress-report-october-2018-fc38d4769e65">Health update</a>, <a rel="me" href="https://humanwhocodes.com/about">More about me</a>)</p>
                    </div>
                </div>
            </div>
            <div class="margin-top sidebar-width hide-on-small-screens">
                <h2 class="no-margin-top">On the Web</h2>
                <ul>
                    <li><a href="https://www.twitter.com/slicknet/">Twitter</a></li>
                    <li><a href="https://www.github.com/nzakas/">GitHub</a></li>
                    <li><a href="https://www.instagram.com/humanwhocodes">Instagram</a></li>
                    <li><a href="https://www.youtube.com/channel/UC95Pwj8oPPZN2mJCEtMqOsg">YouTube</a></li>
                    <li><a href="https://www.linkedin.com/in/nzakas">LinkedIn</a></li>
                    <li><a href="https://www.slideshare.net/nzakas/presentations/">Slideshare</a></li>
                    <li><a href="https://amazon.com/author/nzakas/">Amazon</a></li>
                </ul>
            </div>
        </div>
        <p class="center-text"><a href="https://humanwhocodes.com/policies/privacy">Privacy Policy</a> | <a href="https://humanwhocodes.com/policies/terms">Terms of Service</a></p>
        <p class="center-text">Copyright &copy; 2004-2021 Human Who Codes LLC. Content licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/" rel="nofollow noopener">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.<br>All code examples on all pages, unless otherwise indicated, are <a href="https://humanwhocodes.com/license">BSD licensed</a>.<br>Some links may be affiliate links. We may get paid if you buy something or take an action after clicking one of these. As an Amazon Associate we earn from qualifying purchases. <a href="https://humanwhocodes.com/feeds/blog.xml">Blog Feed</a></p>
    </div>
</footer>

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-6849003-1', 'auto');  // Replace with your property ID.
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->
</body>
</html>

